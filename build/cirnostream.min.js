!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).CirnoStream=t()}(this,(function(){"use strict";function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){s=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}(e,t)||s(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){if(e){if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function c(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,f(e,t,"get"))}function l(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,f(e,t,"set"),n),n}function f(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function y(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}function h(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function p(e,t,n){h(e,t),t.set(e,n)}function m(e,t){h(e,t),t.add(e)}var d=function(){var e;"undefined"!=typeof crypto&&crypto.getRandomValues&&(e=crypto.getRandomValues.bind(crypto)),"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&(e=msCrypto.getRandomValues.bind(msCrypto));for(var t=[3,5,7,9],n=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12})$/i,r=[],o=0;o<256;++o)r.push((o+256).toString(16).substr(1));return function(o){if(!e)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");var i=e(new Uint8Array(16)),a="";i[6]=15&i[6]|64,i[8]=63&i[8]|128;for(var s=0;s<16;++s)a+=r[i[s]],t.indexOf(s)>=0&&(a+="-");if("string"==typeof a&&n.test(a))return o?a.replace(/-/g,""):a;throw TypeError("Stringified UUID is invalid")}}();function v(e,t){return{type:t,name:e.name,delay:e.delay,onProccess:e.onProccess,repeat:e.repeat,remain:e.remain,createTime:e.createTime,runtime:e.runtime,isLoopEvent:e.isLoopEvent,close:e.close,freeze:e.freeze,release:e.release}}function b(e,t){if(!e.onProccess&&(t.runTime-e.createTime)*t.delay>=e.delay){var n=e.eventList.length,r=n>0?e.eventList.shift():e.handler;if((e.isLoopEvent||e.repeat>n)&&r&&e.eventList.push(r),(e.isLoopEvent||e.remain>0)&&"function"==typeof r)try{r(v(e,"execute"))}catch(e){console.error(e)}e.refresh(e),!e.isLoopEvent&&e.decrease(e)}}var g=new WeakMap,w=function(){function e(){n(this,e),p(this,g,{writable:!0,value:void 0}),l(this,g,0)}return o(e,[{key:"counter",get:function(){return c(this,g)}},{key:"count",value:function(){return l(this,g,c(this,g)+1),c(this,g)}},{key:"reset",value:function(){l(this,g,0)}}]),e}(),k=new WeakMap,T=new WeakMap,E=function(){function t(e,r){n(this,t),p(this,k,{writable:!0,value:void 0}),p(this,T,{writable:!0,value:void 0}),l(this,T,e),l(this,k,r),this.created=r.created,this.onclose=r.onclose,this.handler=r.handler,this.eventList=r.eventList}return o(t,[{key:"delay",get:function(){return c(this,k).delay},set:function(e){c(this,k).delay="number"==typeof e?e:1e3}},{key:"onProccess",get:function(){return c(this,k).onProccess},set:function(e){c(this,k).onProccess=e}},{key:"name",get:function(){return c(this,k).name}},{key:"repeat",get:function(){return c(this,k).repeat}},{key:"remain",get:function(){return c(this,k).remainTimes}},{key:"createTime",get:function(){return c(this,k).createTime}},{key:"runtime",get:function(){return c(this,k).runtime}},{key:"isLoopEvent",get:function(){return c(this,k).isLoopEvent}},{key:"data",get:function(){return function(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?e(Object(r),!0).forEach((function(e){i(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},c(this,k))}},{key:"close",get:function(){var e=this;return function(){"function"==typeof e.onclose&&e.onclose(v(e,"closed")),e.onclose=null,c(e,T).delete(e.name)}}},{key:"decrease",get:function(){var e=this;return function(t){if(t!==e)throw new Error("EventDecrease should not be executed manualy.");c(e,k).remainTimes-=1,!e.isLoopEvent&&e.remain<=0&&e.close()}}},{key:"refresh",get:function(){var e=this;return function(t){if(t!==e)throw new Error("EvnetRefresh should not be executed manualy.");c(e,k).runtime+=1,c(e,k).createTime=c(e,T).runTime,e.handler||e.eventList.length||e.close()}}},{key:"freeze",get:function(){var e=this;return function(){c(e,k).onProccess=!0}}},{key:"release",get:function(){var e=this;return function(){c(e,k).onProccess=!1}}}]),t}(),L=new WeakMap,P=new WeakMap,O=new WeakMap,j=new WeakMap,S=new WeakMap,A=new WeakSet;function M(){var e=this;l(this,j,(function t(){l(e,S,setTimeout((function(){if(!e.stopProccess){c(e,L).count();var n,r=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=s(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}(c(e,P).entries());try{for(r.s();!(n=r.n()).done;){var o=a(n.value,2),i=o[0],u=o[1];u?b(u,e):e.delete(i)}}catch(e){r.e(e)}finally{r.f()}t()}}),e.delay))})),l(this,O,(function(t){return c(e,P).get(t)||{}}))}return function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;n(this,e),m(this,A),p(this,L,{writable:!0,value:void 0}),p(this,P,{writable:!0,value:void 0}),p(this,O,{writable:!0,value:void 0}),p(this,j,{writable:!0,value:void 0}),p(this,S,{writable:!0,value:void 0}),this.delay=t,this.stopProccess=!1,l(this,P,new Map),l(this,L,new w),y(this,A,M).call(this),this.start()}return o(e,[{key:"runTime",get:function(){return c(this,L).counter}},{key:"changeDelay",value:function(e,t){var n=c(this,O).call(this,e);n&&(n.delay=t)}},{key:"getEvent",value:function(e){var t;return v(c(t=c(this,P),O).call(t,e).data,"get")}},{key:"delete",value:function(e){var t=c(this,O).call(this,e);if(t)return t&&"function"==typeof t.onclose&&(t.onclose(t),t.onclose=null),c(this,P).delete(e)}},{key:"on",value:function(e){var t=c(this,O).call(this,e);if(t){var n=t.eventList[0]||t.handler;"function"==typeof n&&n(v(t,"forced"))}}},{key:"start",value:function(e){"number"==typeof e&&(this.delay=e),this.stopProccess=!1,c(this,j).call(this)}},{key:"pause",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.stopProccess=!0,new Promise((function(n){Number(t)>0?setTimeout((function(){e.resume(),n(+new Date)}),t):n()}))}},{key:"resume",value:function(e){this.stopProccess&&this.start(e)}},{key:"close",value:function(){clearTimeout(c(this,S)),this.stopProccess=!0,c(this,P).clear()}},{key:"push",value:function(e,n,r,o){try{var i=function(e,n,r,o,i){var a="function"==typeof e?{handler:e}:Array.isArray(e)?{eventList:e}:e;if("boolean"==typeof n&&(o=n,r="",n=1e3),"boolean"==typeof r&&(o=r,r=""),"string"!=typeof r&&(r=""),"object"!==t(a)||!a)throw new Error("First arguments must be Object, Function, or Array.");var s={name:r||a.name,repeat:a.repeat,onProccess:a.onProccess||!1,createTime:i,runtime:1,remainTimes:parseInt(a.repeat,10),isLoopEvent:!1,delay:"number"==typeof n?n:a.delay||1e3,created:a.created||null,onclose:a.onclose||null,handler:a.handler||null,eventList:Array.isArray(a.eventList)?a.eventList:[]};if("string"!=typeof s.name&&(s.name=d(!0)),"function"!=typeof s.handler&&!s.eventList.length)throw new Error("Property<handler or eventList> of StreamEvent should atleast includes an excutionable Function.");return s.eventList=s.eventList.map((function(e){return"function"==typeof e?e:function(){}})),s.remainTimes=Number.isNaN(s.remainTimes)?1:Math.max(s.remainTimes,0),!s.handler&&0!==s.remainTimes&&s.eventList.length>s.remainTimes&&(s.remainTimes=s.eventList.length),Array.isArray(e)&&(s.remainTimes=e.length),s.repeat=s.remainTimes,s.isLoopEvent=0===s.repeat,"boolean"==typeof o&&(s.repeat=o?0:s.repeat,s.isLoopEvent=o),s}(e,n,r,o,this.runTime),a=new E(this,i);return c(this,P).set(a.name,a),"function"==typeof a.created&&(a.created(v(a,"created")),a.created=null),a.name}catch(e){console.error(e)}}}]),e}()}));
