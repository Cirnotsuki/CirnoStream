!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).CirnoStream=t()}(this,(function(){"use strict";function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){s=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}(e,t)||s(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){if(e){if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function c(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,f(e,t,"get"))}function l(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,f(e,t,"set"),n),n}function f(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function h(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}var y=require("uuid");function p(e,t){return e.type=t,delete e.decrease,delete e.refresh,delete e.created,delete e.onclose,delete e.handler,delete e.eventList,e}function d(e,t){if(!e.onProccess&&(t.runTime-e.createTime)*t.delay>=e.delay){var n=e.eventList.length,r=n>0?e.eventList.shift():e.handler;if(e.isLoopEvent&&n>0&&r&&e.eventList.push(r),(e.isLoopEvent||e.remain>0)&&"function"==typeof r)try{r(p(e.data,"excute"))}catch(e){console.error(e)}e.refresh(e),!e.isLoopEvent&&e.decrease(e)}}var v=new WeakMap,m=function(){function e(){n(this,e),v.set(this,{writable:!0,value:void 0}),l(this,v,0)}return o(e,[{key:"counter",get:function(){return c(this,v)}},{key:"count",value:function(){return l(this,v,c(this,v)+1),c(this,v)}},{key:"reset",value:function(){l(this,v,0)}}]),e}(),b=new WeakMap,g=new WeakMap,w=function(){function t(e,r){n(this,t),b.set(this,{writable:!0,value:void 0}),g.set(this,{writable:!0,value:void 0}),l(this,g,e),l(this,b,r),this.created=r.created,this.onclose=r.onclose,this.handler=r.handler,this.eventList=r.eventList}return o(t,[{key:"delay",get:function(){return c(this,b).delay},set:function(e){c(this,b).delay="number"==typeof e?e:1e3}},{key:"onProccess",get:function(){return c(this,b).onProccess},set:function(e){c(this,b).onProccess=e}},{key:"name",get:function(){return c(this,b).name}},{key:"repeat",get:function(){return c(this,b).repeat}},{key:"remain",get:function(){return c(this,b).remainTimes}},{key:"createTime",get:function(){return c(this,b).createTime}},{key:"runtime",get:function(){return c(this,b).runtime}},{key:"isLoopEvent",get:function(){return c(this,b).isLoopEvent}},{key:"data",get:function(){return function(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?e(Object(r),!0).forEach((function(e){i(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},c(this,b))}},{key:"close",get:function(){var e=this;return function(){"function"==typeof e.onclose&&e.onclose(p(e.data,"closed")),e.onclose=null,c(e,g).delete(e.name)}}},{key:"decrease",get:function(){var e=this;return function(t){if(t!==e)throw new Error("EventDecrease should not be excuted manualy.");c(e,b).remainTimes-=1,!e.isLoopEvent&&e.remain<=0&&e.close()}}},{key:"refresh",get:function(){var e=this;return function(t){if(t!==e)throw new Error("EvnetRefresh should not be excuted manualy.");c(e,b).runtime+=1,c(e,b).createTime=c(e,g).runTime,e.handler||e.eventList.length||e.close()}}},{key:"freeze",get:function(){var e=this;return function(){c(e,b).onProccess=!0}}},{key:"release",get:function(){var e=this;return function(){c(e,b).onProccess=!1}}}]),t}(),k=new WeakMap,T=new WeakMap,E=new WeakMap,P=new WeakMap,L=new WeakMap,O=new WeakSet;function j(){var e=this;l(this,P,(function t(){l(e,L,setTimeout((function(){if(!e.stopProccess){c(e,k).count();var n,r=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=s(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}(c(e,T).entries());try{for(r.s();!(n=r.n()).done;){var o=a(n.value,2),i=o[0],u=o[1];u?d(u,e):e.delete(i)}}catch(e){r.e(e)}finally{r.f()}t()}}),e.delay))})),l(this,E,(function(t){return c(e,T).get(t)||{}}))}return function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;n(this,e),O.add(this),k.set(this,{writable:!0,value:void 0}),T.set(this,{writable:!0,value:void 0}),E.set(this,{writable:!0,value:void 0}),P.set(this,{writable:!0,value:void 0}),L.set(this,{writable:!0,value:void 0}),this.delay=t,this.stopProccess=!1,l(this,T,new Map),l(this,k,new m),h(this,O,j).call(this),this.start()}return o(e,[{key:"runTime",get:function(){return c(this,k).counter}},{key:"changeDelay",value:function(e,t){var n=c(this,E).call(this,e);n&&(n.delay=t)}},{key:"getEvent",value:function(e){var t;return p(c(t=c(this,T),E).call(t,e).data,"get")}},{key:"delete",value:function(e){var t=c(this,E).call(this,e);if(t)return t&&"function"==typeof t.onclose&&(t.onclose(t),t.onclose=null),c(this,T).delete(e)}},{key:"on",value:function(e){var t=c(this,E).call(this,e);if(t){var n=t.eventList[0]||t.handler;"function"==typeof n&&n(p(t.data,"forced"))}}},{key:"start",value:function(e){"number"==typeof e&&(this.delay=e),this.stopProccess=!1,c(this,P).call(this)}},{key:"pause",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.stopProccess=!0,new Promise((function(n){Number(t)>0?setTimeout((function(){e.resume(),n(+new Date)}),t):n()}))}},{key:"resume",value:function(e){this.stopProccess&&this.start(e)}},{key:"close",value:function(){clearTimeout(c(this,L)),this.stopProccess=!0,c(this,T).clear()}},{key:"push",value:function(e,n,r,o){try{var i=function(e,n,r,o,i){var a="function"==typeof e?{handler:e}:Array.isArray(e)?{eventList:e}:e;if("boolean"==typeof n&&(o=n,r="",n=1e3),"boolean"==typeof r&&(o=r,r=""),"string"!=typeof r&&(r=""),"object"!==t(a)||!a)throw new Error("First arguments must be Object, Function, or Array.");var s={name:r||a.name,repeat:a.repeat,onProccess:a.onProccess||!1,createTime:i,runtime:1,remainTimes:parseInt(a.repeat,10),isLoopEvent:!1,delay:"number"==typeof n?n:a.delay||1e3,created:a.created||null,onclose:a.onclose||null,handler:a.handler||null,eventList:Array.isArray(a.eventList)?a.eventList:[]};if("string"!=typeof s.name&&(s.name=y.v4().replace(/-/g,"")),"function"!=typeof s.handler&&!s.eventList.length)throw new Error("Event Object should contain an excutionable Function at property handler or eventList.");return s.remainTimes=Number.isNaN(s.remainTimes)?1:Math.max(s.remainTimes,0),Array.isArray(e)&&(s.remainTimes=e.length),s.repeat=s.remainTimes,s.isLoopEvent=0===s.repeat,"boolean"==typeof o&&(s.repeat=o?0:s.repeat,s.isLoopEvent=o),s}(e,n,r,o,this.runTime),a=new w(this,i);return c(this,T).set(a.name,a),"function"==typeof a.created&&(a.created(p(a.data,"created")),a.created=null),a.name}catch(e){console.error(e)}}}]),e}()}));
